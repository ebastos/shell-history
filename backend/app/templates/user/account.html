{% extends 'layout/base.html' %}

{% block title %}Account - Shell History{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ðŸ‘¤ My Account</h1>
</div>

<div class="grid" style="display: grid; gap: 2rem; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
    <div class="card">
        <h3>User Information</h3>
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            <div style="display: flex; flex-direction: column;">
                <span style="font-size: 0.8rem; color: var(--text-secondary);">Username</span>
                <span style="font-weight: 600;">{{ user.username }}</span>
            </div>
            <div style="display: flex; flex-direction: column;">
                <span style="font-size: 0.8rem; color: var(--text-secondary);">Email</span>
                <span style="font-weight: 600;">{{ user.email }}</span>
            </div>
            <div style="display: flex; flex-direction: column;">
                <span style="font-size: 0.8rem; color: var(--text-secondary);">Role</span>
                <span class="badge badge-success" style="width: fit-content;">{{ user.role }}</span>
            </div>
        </div>
    </div>

    <div class="card">
        {% include 'user/partials/change_email_form.html' %}
    </div>

    <div class="card">
        {% include 'user/partials/change_password_form.html' %}
    </div>
</div>

<div class="card" style="margin-top: 2rem;">
    <div class="page-header" style="margin-bottom: 1.5rem;">
        <h3>ðŸ”‘ API Keys</h3>
        <button class="btn btn-primary" hx-post="/account/api-keys" hx-target="#api-keys-list" hx-swap="beforeend">
            <span>+</span> Create API Key
        </button>
    </div>

    <div id="api-keys-list" style="display: grid; gap: 1rem;">
        {% if api_keys %}
        {% for key in api_keys %}
        <div class="card" id="api-key-{{ key.id }}"
            style="background: rgba(255, 255, 255, 0.03); padding: 1rem; flex-direction: row; justify-content: space-between; align-items: center; display: flex;">
            <div>
                <div style="font-weight: 600;">{{ key.name or "Unnamed Key" }}</div>
                <div style="font-size: 0.8rem; color: var(--text-secondary);">
                    Created: {{ key.created_at.strftime('%Y-%m-%d') }}
                    {% if key.last_used_at %}| Last used: {{ key.last_used_at.strftime('%Y-%m-%d') }}{% endif %}
                </div>
            </div>
            <button class="btn btn-danger" hx-post="/account/api-keys/{{ key.id }}/revoke"
                hx-target="#api-key-{{ key.id }}" hx-swap="outerHTML">Revoke</button>
        </div>
        {% endfor %}
        {% else %}
        <p style="text-align: center; color: var(--text-secondary); padding: 2rem;">No API keys yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
